# Используем официальный образ Node.js в качестве базового образа для сборки
FROM node:14 AS build

# Установка рабочей директории внутри контейнера
WORKDIR /usr/src/app

# Копирование package.json и package-lock.json для установки зависимостей
COPY package.json ./

# Установка зависимостей для сборки приложения
RUN npm install --production

# Копирование исходного кода и HTML файла в контейнер
COPY index.html ./
COPY server.js ./

# Опционально: Можно здесь провести дополнительные шаги сборки, если необходимо

# Второй этап Docker с минимальным образом для запуска приложения
FROM node:14-alpine

# Установка рабочей директории внутри контейнера
WORKDIR /usr/src/app

# Копирование собраных файлов из предыдущего этапа
COPY --from=build /usr/src/app ./

# Экспонирование порта 3000 из контейнера
EXPOSE 3000

# Команда для запуска приложения
CMD [ "node", "server.js" ]
